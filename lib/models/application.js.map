{"version":3,"sources":["models/application.js"],"names":[],"mappings":"AAAA;;AACA,IAAI,WAAW,QAAQ,UAAR,CAAX;AACJ,IAAI,UAAU,QAAQ,yBAAR,CAAV;AACJ,IAAI,aAAa,QAAQ,oBAAR,CAAb;AACJ,IAAI,YAAY,QAAQ,UAAR,CAAZ;AACJ,IAAI,iBAAiB,QAAQ,wBAAR,CAAjB;AACJ,IAAI,SAAS,QAAQ,cAAR,CAAT;;AAEJ,IAAI,SAAS,SAAS,MAAT;AACb,IAAI,oBAAoB,IAAI,MAAJ,CAAW;AACjC,iBAAe,MAAf;;AAEA,gBAAc;AACZ,UAAM,OAAN;AACA,cAAU,4CAAV;AACA,WAAO,IAAP;AACA,SAAK,cAAL;GAJF;;AAOA,QAAM;AACJ,UAAM,MAAN;GADF;AAGA,OAAK;AACH,UAAM,OAAN;AACA,UAAM,EAAN;AACA,aAAS,CAAT;AACA,SAAK,EAAL;GAJF;;AAOA,SAAO;AACL,UAAM,CAAC,MAAD,CAAN;AACA,WAAO,IAAP;GAFF;AAIA,YAAU;AACR,SAAK,KAAL;AACA,YAAQ,MAAR;AACA,iBAAa,MAAb;GAHF;AAKA,UAAQ;AACN,SAAK,KAAL;AACA,WAAO,MAAP;AACA,eAAW,MAAX;GAHF;;AAMA,aAAW;AACT,UAAM,MAAN;AACA,YAAQ,IAAR;AACA,WAAO,IAAP;AACA,cAAU,IAAV;AACA,aAAS,oBAAY;AACnB,aAAO,QAAQ,SAAR,EAAmB,MAAnB,EAAP,CADmB;KAAZ;GALX;;;AAWA,UAAQ;AACN,UAAM,MAAN;AACA,YAAQ,IAAR;AACA,WAAO,IAAP;AACA,cAAU,IAAV;AACA,aAAS,oBAAY;AACnB,aAAO,OAAO,CAAP,EAAP,CADmB;KAAZ;GALX;;AAUA,WAAS;AACP,UAAM,MAAN;AACA,YAAQ,IAAR;AACA,cAAU,IAAV;AACA,aAAS,oBAAY;AACnB,aAAO,OAAO,CAAP,CAAS;AACd,wBAAgB,IAAhB;OADK,CAAP,CADmB;KAAZ;GAJX;;;AAYA,wBAAsB;AACpB,SAAK,CAAC;AACJ,YAAM,MAAN;KADG,CAAL;AAGA,UAAM,CAAC;AACL,YAAM,MAAN;KADI,CAAN;AAGA,UAAM,CAAC;AACL,YAAM,MAAN;KADI,CAAN;GAPF;;AAYA,YAAU;AACR,SAAK;AACH,YAAM,OAAO,KAAP,CAAa,KAAb;KADR;AAGA,UAAM;AACJ,YAAM,OAAO,KAAP,CAAa,KAAb;KADR;AAGA,UAAM;AACJ,YAAM,OAAO,KAAP,CAAa,KAAb;KADR;GAPF;;AAYA,cAAY;AACV,SAAK;AACH,YAAM,IAAN;KADF;AAGA,UAAM;AACJ,YAAM,IAAN;KADF;AAGA,UAAM;AACJ,YAAM,IAAN;KADF;GAPF;;AAYA,cAAY;AACV,UAAM;AACJ,eAAS,MAAT;AACA,YAAM,MAAN;AACA,YAAM,MAAN;KAHF;GADF;;AAQA,YAAU;AACR,UAAM,OAAN;AACA,aAAS,KAAT;GAFF;;AAKA,QAAM;AACJ,UAAM,MAAN;AACA,WAAO,IAAP;GAFF;;;;AAOA,cAAY;AACV,UAAM,OAAN;AACA,aAAS,KAAT;GAFF;AAIA,gBAAc;AACZ,UAAM,MAAN;AACA,WAAO,IAAP;AACA,aAAS,CAAT;GAHF;AAKA,oBAAkB;AAChB,UAAM,MAAN;AACA,WAAO,IAAP;AACA,aAAS,CAAT;GAHF;CArIsB,EA0IrB;AACD,QAAM,SAAN;CA3IsB,CAApB;;AA8IJ,kBAAkB,MAAlB,CAAyB,UAAzB;AACA,kBAAkB,MAAlB,CAAyB,cAAzB;AACA,kBAAkB,GAAlB,CAAsB,QAAtB,EAAgC;AAC9B,YAAU,IAAV;CADF;AAGA,kBAAkB,OAAlB,CAA0B,SAA1B,EAAqC,GAArC,CAAyC,YAAY;AACnD,SAAO,KAAK,IAAL,CAD4C;CAAZ,CAAzC,CAEG,GAFH,CAEO,UAAU,KAAV,EAAiB;AACtB,OAAK,IAAL,GAAY,KAAZ,CADsB;CAAjB,CAFP;;AAOA,SAAS,KAAT,CAAe,aAAf,EAA8B,iBAA9B;;AAEA,IAAI,cAAc,SAAS,KAAT,CAAe,aAAf,CAAd;AACJ,UAAU,YAAV,CAAuB,WAAvB;AACA,UAAU,YAAV,CAAuB,YAAY,SAAZ,CAAvB;AACA,QAAQ,IAAR,GAAe,aAAf;AACA,QAAQ,KAAR,GAAgB,WAAhB","file":"models/application.js","sourcesContent":["'use strict';\nvar mongoose = require('mongoose');\nvar ShortId = require('@hoist/mongoose-shortid');\nvar timestamps = require('mongoose-timestamp');\nvar BBPromise = require('bluebird');\nvar mongooseDelete = require('@hoist/mongoose-delete');\nvar keygen = require('keygenerator');\n\nvar Schema = mongoose.Schema;\nvar ApplicationSchema = new Schema({\n  schemaVersion: String,\n  //the org that owns this application\n  organisation: {\n    type: ShortId,\n    required: 'Application must belong to an Organisation',\n    index: true,\n    ref: 'Organisation'\n  },\n  //friendly name\n  name: {\n    type: String\n  },\n  _id: {\n    type: ShortId,\n    base: 64,\n    retries: 4,\n    len: 20\n  },\n  //url alias\n  alias: {\n    type: [String],\n    index: true\n  },\n  runscope: {\n    _id: false,\n    bucket: String,\n    accessToken: String\n  },\n  loggly: {\n    _id: false,\n    token: String,\n    subdomain: String\n  },\n  //the app.hoi.io sub domain for hosting\n  subDomain: {\n    type: String,\n    unique: true,\n    index: true,\n    required: true,\n    default: function () {\n      return require('moniker').choose();\n    }\n  },\n\n  //api key\n  apiKey: {\n    type: String,\n    unique: true,\n    index: true,\n    required: true,\n    default: function () {\n      return keygen._();\n    }\n  },\n  //the storage for data\n  dataKey: {\n    type: String,\n    unique: true,\n    required: true,\n    default: function () {\n      return keygen._({\n        forceLowercase: true\n      });\n    }\n  },\n  //anonymous\n\n  anonymousPermissions: {\n    dev: [{\n      type: String\n    }],\n    test: [{\n      type: String\n    }],\n    live: [{\n      type: String\n    }]\n  },\n  //settings from the hoist.json files\n  settings: {\n    dev: {\n      type: Schema.Types.Mixed\n    },\n    test: {\n      type: Schema.Types.Mixed\n    },\n    live: {\n      type: Schema.Types.Mixed\n    },\n  },\n  //when was the code last released\n  lastDeploy: {\n    dev: {\n      type: Date\n    },\n    test: {\n      type: Date\n    },\n    live: {\n      type: Date\n    }\n  },\n  //information about the commit\n  lastCommit: {\n    live: {\n      message: String,\n      sha1: String,\n      user: String\n    }\n  },\n  //should this application get preview features\n  isCanary: {\n    type: Boolean,\n    default: false\n  },\n  //path to the git repository\n  slug: {\n    type: String,\n    index: true\n  },\n  //should the applicaiton have split queues for executors\n  //eventually everything will be true but for now we need to turn it\n  //on one application at a time\n  splitQueue: {\n    type: Boolean,\n    default: false\n  },\n  maxExecutors: {\n    type: Number,\n    index: true,\n    default: 1\n  },\n  currentExecutors: {\n    type: Number,\n    index: true,\n    default: 0\n  }\n}, {\n  read: 'nearest'\n});\n\nApplicationSchema.plugin(timestamps);\nApplicationSchema.plugin(mongooseDelete);\nApplicationSchema.set('toJSON', {\n  virtuals: true\n});\nApplicationSchema.virtual('gitRepo').get(function () {\n  return this.slug;\n}).set(function (value) {\n  this.slug = value;\n});\n\n\nmongoose.model('Application', ApplicationSchema);\n\nvar Application = mongoose.model('Application');\nBBPromise.promisifyAll(Application);\nBBPromise.promisifyAll(Application.prototype);\nexports.name = 'Application';\nexports.model = Application;\n"],"sourceRoot":"/source/"}